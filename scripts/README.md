# BinDiff API å®¢æˆ·ç«¯è„šæœ¬

è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ BinDiff API å®¢æˆ·ç«¯è„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–è°ƒç”¨ BinDiff ç›¸ä¼¼åº¦æœç´¢æœåŠ¡ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ™ºèƒ½æ–‡ä»¶æ‰«æ
- **å¤šç§æ–‡ä»¶ç±»å‹æ”¯æŒ**: è‡ªåŠ¨è¯†åˆ« Windows PEã€Linux ELFã€macOS Mach-O ç­‰å¯æ‰§è¡Œæ–‡ä»¶
- **çµæ´»æ‰«ææ¨¡å¼**: æ”¯æŒé€’å½’å’Œéé€’å½’ç›®å½•æ‰«æ
- **æ™ºèƒ½ç±»å‹æ£€æµ‹**: ç»“åˆæ–‡ä»¶æ‰©å±•åã€MIMEç±»å‹å’Œlibmagicæ£€æµ‹
- **æ–‡ä»¶æ•°é‡æ§åˆ¶**: æ”¯æŒæœ€å¤§æ–‡ä»¶æ•°é‡é™åˆ¶ï¼Œé¿å…è¿‡åº¦å¤„ç†

### ğŸš€ é«˜æ•ˆæ‰¹é‡å¤„ç†
- **å¹¶å‘æ‰§è¡Œ**: æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†é€Ÿåº¦
- **è¿›åº¦ç›‘æ§**: å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦å’ŒæˆåŠŸç‡
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå•ä¸ªæ–‡ä»¶å¤±è´¥ä¸å½±å“æ•´ä½“å¤„ç†
- **èµ„æºç®¡ç†**: æ™ºèƒ½çš„èµ„æºç®¡ç†å’Œæ¸…ç†æœºåˆ¶

### ğŸ“Š çµæ´»çš„ç»“æœå¤„ç†
- **JSONæ ¼å¼è¾“å‡º**: ç»“æ„åŒ–çš„JSONç»“æœï¼Œä¾¿äºåç»­åˆ†æ
- **ç»“æœè¿‡æ»¤**: æ”¯æŒæŒ‰ç›¸ä¼¼åº¦é˜ˆå€¼å’Œæ¶æ„è½¯ä»¶å®¶æ—è¿‡æ»¤
- **è¯¦ç»†å…ƒæ•°æ®**: åŒ…å«å¤„ç†æ—¶é—´ã€ç»Ÿè®¡ä¿¡æ¯ç­‰è¯¦ç»†å…ƒæ•°æ®
- **æ•°æ®å®Œæ•´æ€§**: ä¿è¯æ‰€æœ‰å¤„ç†ç»“æœçš„å®Œæ•´è®°å½•

### ğŸ›¡ï¸ ä¼ä¸šçº§ç¨³å®šæ€§
- **æœåŠ¡çŠ¶æ€æ£€æŸ¥**: è‡ªåŠ¨æ£€æŸ¥ BinDiff æœåŠ¡å¯ç”¨æ€§
- **è¶…æ—¶æ§åˆ¶**: å¯é…ç½®çš„è¯·æ±‚è¶…æ—¶å’Œé‡è¯•æœºåˆ¶
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¥å¿—å’Œé”™è¯¯è®°å½•
- **å‚æ•°éªŒè¯**: å…¨é¢çš„è¾“å…¥å‚æ•°éªŒè¯

## å®‰è£…ä¾èµ–

```bash
# å®‰è£…Pythonä¾èµ–
pip install requests python-magic

# Ubuntu/Debianç³»ç»Ÿå®‰è£…libmagic
sudo apt-get install libmagic1

# CentOS/RHELç³»ç»Ÿå®‰è£…libmagic
sudo yum install file-libs
```

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```bash

python3 bindiff_api_client.py /home/zraxx/APT/samples/patchwork_20000_5 -r --top-k 5 --min-similarity 0.3 --families Patchwork --workers 1 -o my_results.json

# æ‰«æç›®å½•å¹¶æœç´¢ç›¸ä¼¼æ ·æœ¬
./bindiff_api_client.py /path/to/malware/samples

# æŒ‡å®šè¾“å‡ºæ–‡ä»¶
./bindiff_api_client.py /path/to/samples -o my_results.json
```

### 2. é«˜çº§é€‰é¡¹

```bash
# é€’å½’æ‰«ææ‰€æœ‰å­ç›®å½•
./bindiff_api_client.py /path/to/samples -r

# é™åˆ¶æœ€å¤§æ–‡ä»¶æ•°é‡
./bindiff_api_client.py /path/to/samples --max-files 100

# è°ƒæ•´TOP-Kå€¼
./bindiff_api_client.py /path/to/samples --top-k 20
```

### 3. æ€§èƒ½ä¼˜åŒ–

```bash
# å¢åŠ å¹¶å‘çº¿ç¨‹æ•°
./bindiff_api_client.py /path/to/samples --workers 8

# è°ƒæ•´è¶…æ—¶æ—¶é—´
./bindiff_api_client.py /path/to/samples --timeout 600
```

### 4. ç»“æœè¿‡æ»¤

```bash
# æŒ‰ç›¸ä¼¼åº¦è¿‡æ»¤
./bindiff_api_client.py /path/to/samples --min-similarity 0.8

# æŒ‰æ¶æ„è½¯ä»¶å®¶æ—è¿‡æ»¤
./bindiff_api_client.py /path/to/samples --families Patchwork APT29

# ç»„åˆè¿‡æ»¤æ¡ä»¶
./bindiff_api_client.py /path/to/samples --min-similarity 0.7 --families Lazarus
```

## è¯¦ç»†å‚æ•°è¯´æ˜

### å¿…éœ€å‚æ•°
- `target_directory`: ç›®æ ‡ç›®å½•è·¯å¾„

### è¾“å‡ºé€‰é¡¹
- `-o, --output`: è¾“å‡ºæ–‡ä»¶è·¯å¾„ï¼ˆé»˜è®¤ï¼šè‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³æ–‡ä»¶åï¼‰

### æœåŠ¡é…ç½®
- `--url`: BinDiffæœåŠ¡URLï¼ˆé»˜è®¤ï¼šhttp://localhost:5001ï¼‰
- `--timeout`: è¯·æ±‚è¶…æ—¶æ—¶é—´ç§’æ•°ï¼ˆé»˜è®¤ï¼š300ï¼‰

### æœç´¢å‚æ•°
- `--top-k`: è¿”å›æœ€ç›¸ä¼¼çš„å‰Kä¸ªç»“æœï¼ˆé»˜è®¤ï¼š10ï¼‰

### æ‰«æé€‰é¡¹
- `-r, --recursive`: é€’å½’æ‰«æå­ç›®å½•
- `--max-files`: æœ€å¤§æ–‡ä»¶æ•°é‡é™åˆ¶
- `--no-magic`: ç¦ç”¨libmagicæ–‡ä»¶ç±»å‹æ£€æµ‹

### å¹¶å‘é€‰é¡¹
- `--workers`: å¹¶å‘å·¥ä½œçº¿ç¨‹æ•°ï¼ˆé»˜è®¤ï¼š4ï¼‰

### è¿‡æ»¤é€‰é¡¹
- `--min-similarity`: æœ€å°ç›¸ä¼¼åº¦é˜ˆå€¼ï¼ˆé»˜è®¤ï¼š0.0ï¼‰
- `--families`: æŒ‡å®šæ¶æ„è½¯ä»¶å®¶æ—åˆ—è¡¨

### å…¶ä»–é€‰é¡¹
- `--check-only`: ä»…æ£€æŸ¥æœåŠ¡çŠ¶æ€
- `--verbose, -v`: å¯ç”¨è¯¦ç»†æ—¥å¿—è¾“å‡º

## è¾“å‡ºæ ¼å¼

è„šæœ¬è¾“å‡ºæ ‡å‡†çš„JSONæ ¼å¼ç»“æœï¼š

```json
{
  "results": [
    {
      "file_path": "/path/to/sample.exe",
      "success": true,
      "data": {
        "success": true,
        "results": [
          {
            "family": "Patchwork",
            "hash": "abc123...",
            "path": "/path/to/similar.BinExport",
            "similarity": 0.85,
            "confidence": 0.92,
            "matches": 42,
            "index": 0
          }
        ],
        "search_duration": 2.5,
        "search_timestamp": "2025-09-15T10:30:00",
        "total_results": 5
      }
    }
  ],
  "metadata": {
    "total_files": 10,
    "successful_files": 9,
    "failed_files": 1,
    "generation_time": "2025-09-15T10:35:00",
    "client_version": "1.0.0"
  }
}
```

## æ€§èƒ½å»ºè®®

### 1. å¹¶å‘ä¼˜åŒ–
- **å°æ–‡ä»¶é›†åˆ**ï¼ˆ<100ä¸ªæ–‡ä»¶ï¼‰ï¼šä½¿ç”¨ `--workers 2-4`
- **ä¸­ç­‰æ–‡ä»¶é›†åˆ**ï¼ˆ100-1000ä¸ªæ–‡ä»¶ï¼‰ï¼šä½¿ç”¨ `--workers 4-8`
- **å¤§æ–‡ä»¶é›†åˆ**ï¼ˆ>1000ä¸ªæ–‡ä»¶ï¼‰ï¼šä½¿ç”¨ `--workers 8-16`

### 2. ç½‘ç»œä¼˜åŒ–
- **æœ¬åœ°æœåŠ¡**ï¼šè¶…æ—¶æ—¶é—´å¯è®¾ç½®è¾ƒçŸ­ï¼ˆ180-300ç§’ï¼‰
- **è¿œç¨‹æœåŠ¡**ï¼šå»ºè®®å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆ600-1200ç§’ï¼‰
- **ä¸ç¨³å®šç½‘ç»œ**ï¼šå‡å°‘å¹¶å‘æ•°ï¼Œå¢åŠ è¶…æ—¶æ—¶é—´

### 3. å­˜å‚¨ä¼˜åŒ–
- ä½¿ç”¨SSDå­˜å‚¨å¯æé«˜æ–‡ä»¶æ‰«æé€Ÿåº¦
- ç»“æœæ–‡ä»¶å»ºè®®ä¿å­˜åˆ°é«˜é€Ÿå­˜å‚¨è®¾å¤‡

## ä¸´æ—¶æ–‡ä»¶ç®¡ç†

### ğŸ§¹ è‡ªåŠ¨æ¸…ç†æœºåˆ¶

è„šæœ¬å·²å†…ç½®å¤šé‡æ¸…ç†æœºåˆ¶ï¼Œç¡®ä¿ä¸´æ—¶æ–‡ä»¶ä¸ä¼šå ç”¨è¿‡å¤šç£ç›˜ç©ºé—´ï¼š

1. **æœç´¢å®Œæˆè‡ªåŠ¨æ¸…ç†**: æ¯æ¬¡ç›¸ä¼¼åº¦æœç´¢å®Œæˆåï¼ŒæœåŠ¡ç«¯ä¼šè‡ªåŠ¨æ¸…ç†ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶
2. **æ‰¹é‡å¤„ç†åæ¸…ç†**: APIå®¢æˆ·ç«¯åœ¨æ‰¹é‡å¤„ç†å®Œæˆåä¼šè¯·æ±‚æœåŠ¡ç«¯æ¸…ç†
3. **æ¯”è¾ƒè¿‡ç¨‹æ¸…ç†**: æ¯æ¬¡BinExportæ–‡ä»¶æ¯”è¾ƒå®Œæˆåä¼šç«‹å³æ¸…ç†ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶

### ğŸ› ï¸ æ‰‹åŠ¨æ¸…ç†é€‰é¡¹

å¦‚æœéœ€è¦æ‰‹åŠ¨æ¸…ç†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

```bash
# æ–¹æ³•1: é€šè¿‡APIå®¢æˆ·ç«¯è¯·æ±‚æ¸…ç†
python3 bindiff_api_client.py /tmp --check-only

# æ–¹æ³•2: ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šæ¸…ç†
rm -rf ./out/*
rm -rf ./temp_binexports/*
rm -rf ./temp_uploads/*
```

### ğŸ“Š æ¸…ç†ç»Ÿè®¡

è„šæœ¬ä¼šåœ¨æ¸…ç†æ—¶æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯ï¼š
- æ¸…ç†çš„ä¸´æ—¶æ–‡ä»¶æ•°é‡
- æ¸…ç†çš„ç›®å½•åˆ—è¡¨
- æ¸…ç†æ“ä½œè€—æ—¶

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡è¿æ¥å¤±è´¥**
   ```
   âŒ æ— æ³•è¿æ¥åˆ°BinDiffæœåŠ¡
   ```
   - æ£€æŸ¥BinDiffæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - éªŒè¯æœåŠ¡URLæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸

2. **æ–‡ä»¶ç±»å‹æ£€æµ‹å¤±è´¥**
   ```
   Magicæ£€æµ‹å¤±è´¥: æ–‡ä»¶è·¯å¾„
   ```
   - ç¡®ä¿å·²å®‰è£…libmagicåº“
   - å°è¯•ä½¿ç”¨ `--no-magic` å‚æ•°
   - æ£€æŸ¥æ–‡ä»¶æƒé™

3. **å¤„ç†è¶…æ—¶**
   ```
   âŒ æœç´¢è¶…æ—¶: æ–‡ä»¶è·¯å¾„
   ```
   - å¢åŠ  `--timeout` å‚æ•°å€¼
   - å‡å°‘ `--workers` å¹¶å‘æ•°
   - æ£€æŸ¥æœåŠ¡å™¨æ€§èƒ½

4. **å†…å­˜ä¸è¶³**
   ```
   å†…å­˜åˆ†é…å¤±è´¥
   ```
   - å‡å°‘ `--workers` å¹¶å‘æ•°
   - ä½¿ç”¨ `--max-files` é™åˆ¶å¤„ç†æ–‡ä»¶æ•°
   - å¢åŠ ç³»ç»Ÿå†…å­˜

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—è¿›è¡Œè°ƒè¯•ï¼š

```bash
./bindiff_api_client.py /path/to/samples --verbose
```

### æœåŠ¡çŠ¶æ€æ£€æŸ¥

ä»…æ£€æŸ¥æœåŠ¡çŠ¶æ€è€Œä¸æ‰§è¡Œæœç´¢ï¼š

```bash
./bindiff_api_client.py /path/to/samples --check-only
```

## é›†æˆç¤ºä¾‹

### 1. Shellè„šæœ¬é›†æˆ

```bash
#!/bin/bash
# æ‰¹é‡å¤„ç†å¤šä¸ªç›®å½•

DIRS=("/path/to/dir1" "/path/to/dir2" "/path/to/dir3")
OUTPUT_DIR="/path/to/results"

for dir in "${DIRS[@]}"; do
    echo "å¤„ç†ç›®å½•: $dir"
    output_file="$OUTPUT_DIR/$(basename $dir)_results.json"
    ./bindiff_api_client.py "$dir" -o "$output_file" -r --top-k 15
done
```

### 2. Pythonè„šæœ¬é›†æˆ

```python
import subprocess
import json

def run_bindiff_analysis(directory, output_file):
    cmd = [
        './bindiff_api_client.py',
        directory,
        '-o', output_file,
        '--recursive',
        '--top-k', '10'
    ]
    
    result = subprocess.run(cmd, capture_output=True, text=True)
    
    if result.returncode == 0:
        with open(output_file, 'r') as f:
            return json.load(f)
    else:
        print(f"é”™è¯¯: {result.stderr}")
        return None
```

### 3. å®šæ—¶ä»»åŠ¡é›†æˆ

```bash
# æ·»åŠ åˆ°crontabï¼Œæ¯æ—¥å‡Œæ™¨2ç‚¹æ‰§è¡Œ
0 2 * * * /path/to/bindiff_api_client.py /path/to/samples -o /path/to/daily_results.json -r
```

## å®‰å…¨è€ƒè™‘

1. **æ–‡ä»¶æƒé™**: ç¡®ä¿è„šæœ¬å¯¹ç›®æ ‡ç›®å½•æœ‰è¯»å–æƒé™
2. **ç½‘ç»œå®‰å…¨**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨HTTPSè¿æ¥
3. **æ•°æ®ä¿æŠ¤**: ç»“æœæ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼Œæ³¨æ„è®¿é—®æ§åˆ¶
4. **èµ„æºé™åˆ¶**: åˆç†è®¾ç½®å¹¶å‘æ•°å’Œè¶…æ—¶æ—¶é—´ï¼Œé¿å…èµ„æºè€—å°½

## ç‰ˆæœ¬å†å²

- **v1.0.0**: åˆå§‹ç‰ˆæœ¬
  - åŸºæœ¬çš„ç›®å½•æ‰«æå’ŒAPIè°ƒç”¨åŠŸèƒ½
  - æ‰¹é‡å¤„ç†å’Œå¹¶å‘æ”¯æŒ
  - JSONç»“æœè¾“å‡º
  - å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶

## æ”¯æŒä¸åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æ£€æŸ¥ï¼š
1. BinDiffæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
2. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
3. å‚æ•°é…ç½®æ˜¯å¦æ­£ç¡®
4. ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³

---

**æ³¨æ„**: æ­¤è„šæœ¬éœ€è¦é…åˆè¿è¡Œä¸­çš„BinDiffç›¸ä¼¼åº¦æœç´¢æœåŠ¡ä½¿ç”¨ã€‚è¯·ç¡®ä¿æœåŠ¡æ­£å¸¸è¿è¡Œå¹¶ä¸”ç½‘ç»œè¿æ¥æ­£å¸¸ã€‚
